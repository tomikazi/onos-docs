



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Open Network Operating System (ONOS)">
      
      
        <link rel="canonical" href="https://www.onosproject.org/onos-config/docs/modelplugin/">
      
      
        <meta name="author" content="Open Networking Foundation">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Extending Configuration Subsystem With Model Plugins - onosproject</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#extending-onos-config-with-model-plugins" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.onosproject.org" title="onosproject" class="md-header-nav__button md-logo">
          
            <img src="../../../images/onos_logo_2017.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              onosproject
            </span>
            <span class="md-header-nav__topic">
              Extending Configuration Subsystem With Model Plugins
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/onosproject" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    onosproject
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.onosproject.org" title="onosproject" class="md-nav__button md-logo">
      
        <img src="../../../images/onos_logo_2017.png" width="48" height="48">
      
    </a>
    onosproject
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/onosproject" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    onosproject
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="ONOS" class="md-nav__link">
      ONOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/community-info/" title="Contacts and Calenders" class="md-nav__link">
      Contacts and Calenders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/prerequisites/" title="Development Prerequisites" class="md-nav__link">
      Development Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/dev_workflow/" title="Developer Workflow" class="md-nav__link">
      Developer Workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/contributing/" title="Contribution Guidelines" class="md-nav__link">
      Contribution Guidelines
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Configuration Subsystem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Configuration Subsystem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="An Introduction to Configuration Susbsytem" class="md-nav__link">
      An Introduction to Configuration Susbsytem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build/" title="How To Build Configuration Subsystem?" class="md-nav__link">
      How To Build Configuration Subsystem?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../run/" title="How To Run Configuration Subsystem?" class="md-nav__link">
      How To Run Configuration Subsystem?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../debugging/" title="How To Debug Configuration Subsystem?" class="md-nav__link">
      How To Debug Configuration Subsystem?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/" title="Administrative And Diagnostic CLI" class="md-nav__link">
      Administrative And Diagnostic CLI
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Extending Configuration Subsystem With Model Plugins
      </label>
    
    <a href="./" title="Extending Configuration Subsystem With Model Plugins" class="md-nav__link md-nav__link--active">
      Extending Configuration Subsystem With Model Plugins
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#role-of-the-model-plugin" title="Role of the Model Plugin" class="md-nav__link">
    Role of the Model Plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-of-a-model-plugin" title="Structure of a Model Plugin" class="md-nav__link">
    Structure of a Model Plugin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelplugin-interface" title="ModelPlugin Interface" class="md-nav__link">
    ModelPlugin Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-your-own-model-plugin-using-script" title="Create your own Model Plugin using script" class="md-nav__link">
    Create your own Model Plugin using script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yang-files" title="YANG files" class="md-nav__link">
    YANG files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelmaingo-definitions" title="modelmain.go definitions" class="md-nav__link">
    modelmain.go definitions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modeltype" title="modeltype" class="md-nav__link">
    modeltype
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modelversion" title="modelversion" class="md-nav__link">
    modelversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulename" title="modulename" class="md-nav__link">
    modulename
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modeldata" title="modeldata" class="md-nav__link">
    modeldata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gnmi/" title="Northbound gNMI Service" class="md-nav__link">
      Northbound gNMI Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gnmi_extensions/" title="gNMI Extensions" class="md-nav__link">
      gNMI Extensions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Topology Subsystem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Topology Subsystem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-topo/docs/cli/" title="How To Use Topology Subsystem CLI?" class="md-nav__link">
      How To Use Topology Subsystem CLI?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Command Line Interface Subsystem (CLI)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Command Line Interface Subsystem (CLI)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-cli/docs/setup/" title="How To Install and Run CLI Subsystem?" class="md-nav__link">
      How To Install and Run CLI Subsystem?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Zero-Touch Provisioning (ZTP) Subsystem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Zero-Touch Provisioning (ZTP) Subsystem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-ztp/docs/setup/" title="How To Install And Run ZTP?" class="md-nav__link">
      How To Install And Run ZTP?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Test Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Test Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-test/docs/setup/" title="How To Install and Run ONIT?" class="md-nav__link">
      How To Install and Run ONIT?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-test/docs/run/" title="How To Use ONIT?" class="md-nav__link">
      How To Use ONIT?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-test/docs/testing/" title="How To Write and Run Tests?" class="md-nav__link">
      How To Write and Run Tests?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Graphical User Interface (GUI)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Graphical User Interface (GUI)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/" title="ONOS-GUI Subsystem" class="md-nav__link">
      ONOS-GUI Subsystem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/config-gui/" title="Configuration GUI" class="md-nav__link">
      Configuration GUI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/architecture/" title="GUI Architecture" class="md-nav__link">
      GUI Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/prerequisites/" title="GUI Development Prerequisites" class="md-nav__link">
      GUI Development Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/run/" title="How To Run ONOS GUI?" class="md-nav__link">
      How To Run ONOS GUI?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#role-of-the-model-plugin" title="Role of the Model Plugin" class="md-nav__link">
    Role of the Model Plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-of-a-model-plugin" title="Structure of a Model Plugin" class="md-nav__link">
    Structure of a Model Plugin
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelplugin-interface" title="ModelPlugin Interface" class="md-nav__link">
    ModelPlugin Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-your-own-model-plugin-using-script" title="Create your own Model Plugin using script" class="md-nav__link">
    Create your own Model Plugin using script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yang-files" title="YANG files" class="md-nav__link">
    YANG files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelmaingo-definitions" title="modelmain.go definitions" class="md-nav__link">
    modelmain.go definitions
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modeltype" title="modeltype" class="md-nav__link">
    modeltype
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modelversion" title="modelversion" class="md-nav__link">
    modelversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modulename" title="modulename" class="md-nav__link">
    modulename
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modeldata" title="modeldata" class="md-nav__link">
    modeldata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="extending-onos-config-with-model-plugins">Extending onos-config with Model Plugins</h1>
<p>onos-config is an extensible configuration management system, that allows the
configuration of many different types and versions of devices to be managed
concurrently.</p>
<p>Information models in YANG format (RFC 6020) can be used to accurately define
the configuration and state objects and attributes of a device. In practice a
device's object model usually comprises of a number of YANG files including
augments and deviations, and must be considered as a combined unit.</p>
<p>In <em>onos-config</em> a set of these combined YANG files defining a particular
version of a device type is known as a <code>model</code>.</p>
<p>Over its lifecycle onos-config will have to deal with many different models as
its scope is expanded and as devices go through new release cycles. To allow
this models are loadable dynamically as plugins in the form of Linux or Mac
shared object libraries <code>(\*.so)</code> using the YGOT library and are know as
<strong>Model Plugins</strong>.</p>
<p>The diagram shows the connection between the Model Plugin and the configuration
store - linked by Device Type and Version. Effectively the primary key
of the Model Registry is the Model Name and Version, whereas the primary key of
the Configuration is the Device Name and Version. </p>
<p><img alt="onos-config internals" src="../images/onos-config-internals.png" /></p>
<h2 id="role-of-the-model-plugin">Role of the Model Plugin</h2>
<p>The Model Plugin enables the following functionality in <em>onos-config</em>:</p>
<ol>
<li>Ensures that illegal values are not saved in to the configuration (this covers
wrong data type, data values beyond range or not matching a pattern, lists that
are not within their cardinality limits)</li>
<li>Ensuring that read only values are not allowed to be set</li>
<li>Checking the validity of stores on startup</li>
<li>Enabling the Operational State cache within onos-config </li>
<li>Enabling the retrieval of attributes by type - CONFIG or OPERATIONAL</li>
<li>Enabling clients to access the model metadata through the Admin NBI</li>
<li>Enabling JSON Payloads in gNMI SetRequests to be interpreted</li>
</ol>
<h2 id="structure-of-a-model-plugin">Structure of a Model Plugin</h2>
<p>A Model Plugin is mainly generated by the generator command from the YGOT
project, and a wrapper <code>modelmain.go</code> implementing the ModelPlugin interface.
They are compiled together with the <code>go build</code> command using the
<code>-buildmode=plugin</code> option. </p>
<p>Many examples of Model Plugins are in the <a href="../modelplugin">modelplugin</a>
folder of this project, and an example script
<a href="https://github.com/onosproject/onos-config/blob/master/modelplugin/ModelGenerator.sh">ModelGenerator.sh</a> is available for creating
new plugins.</p>
<h3 id="modelplugin-interface">ModelPlugin Interface</h3>
<p>The model plugin must implement the <code>ModelPlugin</code> interface. This will allow
it to be entered in to the Model Registry.
<pre class="highlight"><code class="language-go">type ModelPlugin interface {
    ModelData() (string, string, []*gnmi.ModelData, string)
    UnmarshalConfigValues(jsonTree []byte) (*ygot.ValidatedGoStruct, error)
    Validate(*ygot.ValidatedGoStruct, ...ygot.ValidationOption) error
    Schema() (map[string]*yang.Entry, error)
}</code></pre></p>
<h3 id="create-your-own-model-plugin-using-script">Create your own Model Plugin using script</h3>
<ol>
<li>Change directory in to onos-config/modelplugins</li>
<li>Copy anyone of the <code>.env</code> files to a new file</li>
<li>Edit the variables at the top of the file to suit your plugin (see
<code>modelmain.go</code> Definitions below for specifics), taking special care that the
entries in MODELDATA are in alphabetical order (YANGDATA is derived from the
MODELDATA but can be overridden if required)</li>
<li>Make sure the required Yang files are present in the <code>./yang</code> folder and named properly</li>
<li>Run the script like
<pre class="highlight"><code class="language-bash">&gt; ./ModelGenerator.sh &lt;filename&gt;.env</code></pre></li>
</ol>
<p>Once the files are created:</p>
<ol>
<li>Change directory back to <em>onos-config</em></li>
<li>Compile the plugin with (replacing the names as appropriate)
<pre class="highlight"><code class="language-bash">&gt; GO111MODULE=on CGO_ENABLED=1 go build -o modelplugin/TestDevice-1.0.0/testdevice.so.1.0.0 -buildmode=plugin -tags=modelplugin ./modelplugin/TestDevice-1.0.0</code></pre></li>
</ol>
<p>Edit the Makefile to include the Model Plugin in the build (or alternatively
create a new Makefile if you want to keep it in a separate project)</p>
<p>Follow the steps in <strong>Loading the Model Plugin</strong> below for how to load it.</p>
<h2 id="yang-files">YANG files</h2>
<p>The YANG files to be used with generator.go should be collected together in a
folder and named in the style: <code>\&lt;modulename&gt;@\&lt;latestrevision&gt;.yang</code></p>
<blockquote>
<p><strong>Note</strong> The Yang files provided are required not to contain overlapping or clashing namespaces at the same path level.
This requirement is necessary during the model compilation in YGOT because this tool offers no support for namespaces 
in the form of <code>/namespace:path/path2</code>, e.g. <code>/openconfig-system:system/clock</code>. YGOT compilation of a model containing 
<code>/openconfig-system:system/clock</code> will result in the path being <code>/system/clock</code></p>
</blockquote>
<p>Running the generator command in the form:
<pre class="highlight"><code class="language-bash">&gt; go run $GOPATH/src/github.com/openconfig/ygot/generator/generator.go \
-path yang -output_file=$TYPEVERSION/$TYPEVERSIONPKG/generated.go -package_name=$TYPEVERSIONPKG \
-generate_fakeroot $YANGLIST</code></pre>
will check all nested dependencies are present, <em>and</em> that the output is
generated as a single file: <code>generated.go</code>.</p>
<blockquote>
<p>Where $YANGLIST is a space separated list of YANG file names.
See ModelGenerator.sh for an example</p>
</blockquote>
<p>To visualize and further validate the collection of YANG files, the
<strong><a href="https://github.com/mbj4668/pyang">pyang</a></strong> tool can be used like:
<pre class="highlight"><code class="language-bash">&gt; pyang -f tree $YANGLIST</code></pre></p>
<blockquote>
<p>Once the generator has run there is no need to persist the YANG files - the
generated.go file contains all the information in an object model.</p>
</blockquote>
<h2 id="modelmaingo-definitions">modelmain.go definitions</h2>
<p>Examples of these definitions are given in the <code>*.env</code> files in the modelplugins folder.</p>
<h3 id="modeltype">modeltype</h3>
<p>This should be a name that defines the type of device, but should not include
version. This name will be used later in the <code>Configuration</code> of the device.
It should be between 4 and 40 chars and only include alphanumeric characters,
dash, underscore and colon.</p>
<h3 id="modelversion">modelversion</h3>
<p>This should be the version number of the device in <a href="https://semver.org/">Semantic Versioning</a>
form. Only numeric characters and '.' character are allowed.</p>
<h3 id="modulename">modulename</h3>
<p>This should be the same as the filename given to the Model Plugin when compiled.
It comprises</p>
<ul>
<li>the modeltype (converted to lower case),</li>
<li>concatenated with '.so.' and</li>
<li>the version.</li>
</ul>
<p>e.g. devicesim.so.1.0.0 </p>
<h3 id="modeldata">modeldata</h3>
<p>The primary YANG files of the device should be listed in the ModelData section
of the <code>modelmain.go</code> file. These are the YANG files that define the top level
containers and lists. During compilation other YANG files may get pulled in
because they define reusable types (but should not be listed in model data).</p>
<p>Each entry in modeldata should be in the format of</p>
<ul>
<li>name - the name of the <code>module</code> inside the YANG file</li>
<li>version - the value of the <code>latest</code> revision inside the YANG file in the
format YYYY-MM-DD</li>
<li>organization - the value from the <code>organization</code> field of the YANG file</li>
</ul>
<blockquote>
<p>There should be no duplicate entries (of name) in the list and the list should be ordered alphabetically.</p>
</blockquote>
<h1 id="loading-the-model-plugin">Loading the Model Plugin</h1>
<p>The Model Plugin can be loaded at the start up of onos-config by specifying the
-modelPlugin argument.
<pre class="highlight"><code class="language-bash">-modelPlugin=$HOME/go/src/github.com/onosproject/onos-config/modelplugin/TestDevice-1.0.0/testdevice.so.1.0.0 \
-modelPlugin=$HOME/go/src/github.com/onosproject/onos-config/modelplugin/TestDevice-2.0.0/testdevice.so.2.0.0 \
-modelPlugin=$HOME/go/src/github.com/onosproject/onos-config/modelplugin/Devicesim-1.0.0/devicesim.so.1.0.0 \
-modelPlugin=$HOME/go/src/github.com/onosproject/onos-config/modelplugin/Stratum-1.0.0/stratum.so.1.0.0</code></pre>
Alternatively these can be loaded later with the onos cli tool - see <a href="../cli/">cli.md</a>.
<pre class="highlight"><code class="language-bash">&gt; onos config add plugin &lt;full path on target machine to shared object model&gt;</code></pre></p>
<blockquote>
<p>Model Plugins cannot be unloaded once loaded, without restarting onos-config.</p>
</blockquote>
<p>To see a list of loaded plugins use the command:
<pre class="highlight"><code class="language-bash">&gt; onos config get plugins</code></pre>
which gives an output like:
<pre class="highlight"><code class="language-bash">&gt; onos config get plugins
TestDevice: 1.0.0 from testdevice.so.1.0.0 containing:
YANGS:
    test1   2018-02-20  Open Networking Foundation

TestDevice: 2.0.0 from testdevice.so.2.0.0 containing:
YANGS:
    test1   2019-06-10  Open Networking Foundation

Devicesim: 1.0.0 from devicesim.so.1.0.0 containing:
YANGS:
    openconfig-interfaces   2017-07-14  OpenConfig working group
    openconfig-openflow 2017-06-01  OpenConfig working group
    openconfig-platform 2016-12-22  OpenConfig working group
    openconfig-system   2017-07-06  OpenConfig working group

Stratum: 1.0.0 from stratum.so.1.0.0 containing:
YANGS:
        openconfig-interfaces                 2.4.1    OpenConfig working group
        openconfig-if-ip                      3.0.0    OpenConfig working group
        openconfig-lacp                       1.1.1    OpenConfig working group
        openconfig-platform                   0.12.2   OpenConfig working group
        openconfig-platform-linecard          0.1.1    OpenConfig working group
        openconfig-platform-port              0.3.2    OpenConfig working group
        openconfig-platform-transceiver       0.7.0    OpenConfig working group
        openconfig-vlan                       3.2.0    OpenConfig working group
        openconfig-system                     0.7.0    OpenConfig working group
        openconfig-hercules-platform-linecard 0.2.0    OpenConfig working group
        openconfig-hercules-qos               0.1.0    OpenConfig working group
        openconfig-hercules-platform          0.2.0    OpenConfig working group
        openconfig-hercules-platform-chassis  0.2.0    OpenConfig working group
        openconfig-hercules-platform-port     0.2.0    OpenConfig working group
        openconfig-hercules                   0.2.0    OpenConfig working group
        openconfig-hercules-interfaces        0.2.0    OpenConfig working group
        openconfig-hercules-platform-node     0.2.0    OpenConfig working group
</code></pre></p>
<p>To see a list of Read-Only and Read-Write paths use the command:
<pre class="highlight"><code class="language-bash">&gt; onos config get plugins -v</code></pre></p>
<blockquote>
<p>In a distributed installation the ModelPlugin will have to be loaded
on all running instances of onos-config.</p>
</blockquote>
<h1 id="model-plugins-and-gnmi-capabilities">Model Plugins and gNMI Capabilities</h1>
<h2 id="capabilities-on-gnmi-northbound-interface">Capabilities on gNMI Northbound interface</h2>
<p>The CapabilitiesResponse on the gNMI northound interface is generated dynamically
from the <code>modeldata</code> section of all of the loaded Model Plugins.</p>
<h2 id="capabilities-comparison-on-southbound-gnmi-interface">Capabilities comparison on Southbound gNMI interface</h2>
<p>At runtime when devices are connected to onos-config the response to the
Capabilities request are compared with the
modeldata for their corresponding ModelPlugin - if there is not an exact
match a warning is displayed.</p>
<h1 id="openconfig-models">OpenConfig Models</h1>
<p>Some devices that support OpenConfig Models report their capabilities using an
OpenConfig versioning scheme e.g. 0.5.0, rather than the YANG revision date in
the format 2017-07-06. If the device can correct its capabilities to give the
revision then it should to be more consistent with non OpenConfig YANG models.</p>
<p>Accessing OpenConfig model of a specific revision requires a number of steps in
<a href="https://github.com/openconfig/public">Github</a>.</p>
<p>For instance if a device reports it used openconfig-interfacess.yang <code>2.0.0</code>,
then to get this file do:</p>
<ul>
<li>Browse to <a href="https://github.com/openconfig/public/blob/master/release/models/interfaces/openconfig-interfaces.yang">openconfig-interfaces.yang</a></li>
<li>Observe in the list of <code>revision</code> items in the YANG file that the reference
<code>2.0.0</code> corresponds to a release date of <code>2017-07-14</code></li>
<li>Click in the <code>History</code> button</li>
<li>In the <code>History</code> page for this file, see that the next commit after this
date was on <code>Aug 9, 2017</code></li>
<li>Click on the related <code>commit message</code></li>
<li>In the list of files modified in that commit click the <code>...</code> next to the file
<code>openconfig-interfacess.yang</code> and choose <code>View File</code></li>
<li>In the page that displays the historical version of the file, click the <code>Raw</code> button</li>
<li>In the resulting raw display of the YANG file verify that the latest revision is <code>2017-07-14</code></li>
<li>Save the file locally as <code>openconfig-interfaces@2017-07-14.yang</code></li>
</ul>
<p>All the files in the <a href="../modelplugin/yang">yang</a> folder were downloaded in this
way. They are not strictly needed once <code>generated.go</code> has been created, but are
kept here for convenience, saving to have to run the procedure above if a change
was needed.</p>
<blockquote>
<p>If the generator program reports that a dependency was required e.g.
<code>openconfig-inet-types.yang</code> then the version of this file with a date equal
to or before 2017-07-14 should be downloaded - it is <code>openconfig-inet-types@2017-07-14.yang</code></p>
</blockquote>
<h2 id="readonly-paths-in-openconfig-models">Readonly paths in OpenConfig models</h2>
<p>When an item in an Openconfig YANG file has "config false" it is effectively a
read-only attribute. Usually with OpenConfig read-only objects are interspersed
throughout the YANG model.</p>
<p>To see a list of Read Only paths use the command:
<pre class="highlight"><code class="language-bash">&gt; onos config get plugins -v</code></pre></p>
<p>When the Model Plugin is loaded, setting of an attribute like <code>state/address</code>
should give an appropriate error</p>
<p><pre class="highlight"><code class="language-bash">&gt; gnmi_cli -address localhost:5150 -set \
    -proto "update: &lt;path: &lt;target: 'localhost-1', elem: &lt;name: 'system'&gt; elem: &lt;name: 'openflow'&gt; elem: &lt;name: 'controllers'&gt; elem: &lt;name: 'controller' key: &lt;key: 'name' value: 'main'&gt;&gt; elem: &lt;name: 'connections'&gt; elem: &lt;name: 'connection' key: &lt;key: 'aux-id' value: '0'&gt;&gt; elem: &lt;name: 'state'&gt; elem: &lt;name: 'address'&gt;&gt; val: &lt;string_val: '192.0.2.11'&gt;&gt;" \
    -timeout 5s -alsologtostderr \
    -client_crt pkg/southbound/testdata/client1.crt \
    -client_key pkg/southbound/testdata/client1.key \
    -ca_crt pkg/southbound/testdata/onfca.crt</code></pre>
gives the error:
<pre class="highlight"><code class="language-bash">rpc error: code = InvalidArgument desc = update contains a change to a read only
  path /system/openflow/controllers/controller[name=main]/connections/connection[aux-id=0]/state/address. Rejected</code></pre></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      



<!-- Application footer -->
<footer class="md-footer">

    <!-- Further information -->
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">

            <!-- Copyright and theme information -->
            <div class="md-footer-copyright">
                
                powered by
                <a href="https://www.mkdocs.org" title="MkDocs">MkDocs</a>
                and
                <a href="https://squidfunk.github.io/mkdocs-material/"
                   title="Material for MkDocs">
                    Material for MkDocs</a>
            </div>

            <!-- Social links -->
            
            
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/onosproject" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://onosproject.slack.com/" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://www.youtube.com/channel/UCTQaOpqno48GTimdwyfytFw" class="md-footer-social__link fa fa-youtube"></a>
    
  </div>

            
        </div>
    </div>
</footer>


    </div>
    
      <script src="../../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>
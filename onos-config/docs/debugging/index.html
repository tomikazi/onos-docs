



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Open Network Operating System (ONOS)">
      
      
        <link rel="canonical" href="https://www.onosproject.org/onos-config/docs/debugging/">
      
      
        <meta name="author" content="Open Networking Foundation">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>How To Debug Configuration Subsystem? - onosproject</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#debug-onos-config-in-onit-using-delve" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.onosproject.org" title="onosproject" class="md-header-nav__button md-logo">
          
            <img src="../../../images/onos_logo_2017.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              onosproject
            </span>
            <span class="md-header-nav__topic">
              How To Debug Configuration Subsystem?
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/onosproject" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    onosproject
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://www.onosproject.org" title="onosproject" class="md-nav__button md-logo">
      
        <img src="../../../images/onos_logo_2017.png" width="48" height="48">
      
    </a>
    onosproject
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/onosproject" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    onosproject
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="ONOS" class="md-nav__link">
      ONOS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/community-info/" title="Contacts and Calenders" class="md-nav__link">
      Contacts and Calenders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/prerequisites/" title="Development Prerequisites" class="md-nav__link">
      Development Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/dev_workflow/" title="Developer Workflow" class="md-nav__link">
      Developer Workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../developers/contributing/" title="Contribution Guidelines" class="md-nav__link">
      Contribution Guidelines
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Configuration Subsystem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Configuration Subsystem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="An Introduction to Configuration Susbsytem" class="md-nav__link">
      An Introduction to Configuration Susbsytem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build/" title="How To Build Configuration Subsystem?" class="md-nav__link">
      How To Build Configuration Subsystem?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../run/" title="How To Run Configuration Subsystem?" class="md-nav__link">
      How To Run Configuration Subsystem?
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        How To Debug Configuration Subsystem?
      </label>
    
    <a href="./" title="How To Debug Configuration Subsystem?" class="md-nav__link md-nav__link--active">
      How To Debug Configuration Subsystem?
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#debugging-example-1-use-goland-ide-recommended" title="Debugging Example #1: Use Goland IDE (Recommended):" class="md-nav__link">
    Debugging Example #1: Use Goland IDE (Recommended):
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-example-2-use-simple-delve-client" title="Debugging. Example #2: Use Simple Delve Client:" class="md-nav__link">
    Debugging. Example #2: Use Simple Delve Client:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#print-local-variables" title="Print Local Variables" class="md-nav__link">
    Print Local Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goroutines" title="Goroutines" class="md-nav__link">
    Goroutines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-your-code-line-by-line" title="Debug Your Code Line by Line" class="md-nav__link">
    Debug Your Code Line by Line
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print-stack-trace" title="Print Stack Trace" class="md-nav__link">
    Print Stack Trace
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/" title="Administrative And Diagnostic CLI" class="md-nav__link">
      Administrative And Diagnostic CLI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../modelplugin/" title="Extending Configuration Subsystem With Model Plugins" class="md-nav__link">
      Extending Configuration Subsystem With Model Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gnmi/" title="Northbound gNMI Service" class="md-nav__link">
      Northbound gNMI Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gnmi_extensions/" title="gNMI Extensions" class="md-nav__link">
      gNMI Extensions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Topology Subsystem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Topology Subsystem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-topo/docs/cli/" title="How To Use Topology Subsystem CLI?" class="md-nav__link">
      How To Use Topology Subsystem CLI?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Command Line Interface Subsystem (CLI)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Command Line Interface Subsystem (CLI)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-cli/docs/setup/" title="How To Install and Run CLI Subsystem?" class="md-nav__link">
      How To Install and Run CLI Subsystem?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Zero-Touch Provisioning (ZTP) Subsystem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Zero-Touch Provisioning (ZTP) Subsystem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-ztp/docs/setup/" title="How To Install And Run ZTP?" class="md-nav__link">
      How To Install And Run ZTP?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Test Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Test Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-test/docs/setup/" title="How To Install and Run ONIT?" class="md-nav__link">
      How To Install and Run ONIT?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-test/docs/run/" title="How To Use ONIT?" class="md-nav__link">
      How To Use ONIT?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-test/docs/testing/" title="How To Write and Run Tests?" class="md-nav__link">
      How To Write and Run Tests?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Graphical User Interface (GUI)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Graphical User Interface (GUI)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/" title="ONOS-GUI Subsystem" class="md-nav__link">
      ONOS-GUI Subsystem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/config-gui/" title="Configuration GUI" class="md-nav__link">
      Configuration GUI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/architecture/" title="GUI Architecture" class="md-nav__link">
      GUI Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/prerequisites/" title="GUI Development Prerequisites" class="md-nav__link">
      GUI Development Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../onos-gui/docs/run/" title="How To Run ONOS GUI?" class="md-nav__link">
      How To Run ONOS GUI?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#debugging-example-1-use-goland-ide-recommended" title="Debugging Example #1: Use Goland IDE (Recommended):" class="md-nav__link">
    Debugging Example #1: Use Goland IDE (Recommended):
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-example-2-use-simple-delve-client" title="Debugging. Example #2: Use Simple Delve Client:" class="md-nav__link">
    Debugging. Example #2: Use Simple Delve Client:
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#print-local-variables" title="Print Local Variables" class="md-nav__link">
    Print Local Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#goroutines" title="Goroutines" class="md-nav__link">
    Goroutines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-your-code-line-by-line" title="Debug Your Code Line by Line" class="md-nav__link">
    Debug Your Code Line by Line
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print-stack-trace" title="Print Stack Trace" class="md-nav__link">
    Print Stack Trace
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="debug-onos-config-in-onit-using-delve">Debug onos-config in Onit Using Delve</h1>
<h2 id="debugging-example-1-use-goland-ide-recommended">Debugging Example #1: Use Goland IDE (Recommended):</h2>
<ul>
<li>
<p>In this example, we assume you already started an onit cluster. If you haven't done that yet, refer to <a href="testing.md">testing</a> for more details.</p>
</li>
<li>
<p>First, you need to configure your <a href="https://www.jetbrains.com/go/">Goland</a> IDE to connect to the remote <a href="https://github.com/go-delve/delve/tree/master/Documentation/installation">Delve</a> debugger which is running in the onos-config 
pod. You can do that by going to <em>Run | Edit Configurations… | + | Go Remote</em> and configuring the host (in this example <em>localhost</em>) and port (in this example port <strong>40000</strong>) your remote debugger is listening on.</p>
</li>
</ul>
<p><img alt="goland_ide_configuration" src="../images/goland_ide_remote_debug.gif" /></p>
<ul>
<li>To start debugging and  open a debugger port to the given resource, you can run <code>onit debug</code> command. For example, to forwards a port to the debug port on the onos-config pod, run the following command:</li>
</ul>
<pre class="highlight"><code class="language-bash">  &gt;onit debug &lt;name of onos-config pod&gt;
  Forwarding from 127.0.0.1:40000 -&gt; 40000
  Forwarding from [::1]:40000 -&gt; 40000</code></pre>

<ul>
<li>To connect to the debugger using Goland IDE, select the configuration that you created 
in the first step and click on <em>Debug</em> button as follows:</li>
</ul>
<p><img alt="goland_ide_connect" src="../images/goland_debug_connect.gif" /></p>
<ul>
<li>If your Goland IDE connects to the debug server which is running in onos-config pod successfully, then you should be able to see the following message in the logs:</li>
</ul>
<pre class="highlight"><code class="language-bash">   &gt; onit get logs &lt;name of onos-config pod&gt;
   ....
   2019-07-22T15:09:27Z debug layer=debugger halting
   2019-07-22T15:09:28Z debug layer=debugger continuing</code></pre>

<ul>
<li>Suppose we want to add a simulator and debug <a href="https://github.com/onosproject/onos-config/blob/master/pkg/southbound/synchronizer/synchronizer.go">synchronizer</a>
code by setting a few breakpoints in different lines of its file as follows:</li>
</ul>
<p><img alt="goland_ide_set_breakpoints" src="../images/goland_debug_set_breakpoints.gif" /> </p>
<ul>
<li>
<p>As you can see above, after setting the breakpoints, you should be able to see some messages
in the onos-config pod logs that confirm you set the breakpoints. When we add a simulator
 the Goland IDE hits the first breakpoint that was set. At this point you can go through the list 
of variables and goroutines using the debugger dashboard. </p>
</li>
<li>
<p>Suppose we want to have tracepoints instead of breakpoints. Tracepoints don't 
cause the program execution to break and they can be useful when you need to inspect something, 
but not stop the program. To do that in Goland IDE, first set a breakpoint and then 
right-click on the breakpoint and unchecking "Suspend" as follows:</p>
</li>
</ul>
<p><img alt="goland_ide_set_tacepoints" src="../images/goland_debug_set_tracepoints.gif" /></p>
<ul>
<li>You can also print a <em>breakpoint hit message</em>, print <em>stack trace</em>, 
and <em>Evaluate and Log</em> variables using tracepoints without pausing the program. For example, suppose we want to
print the address of the device simulator in the <a href="https://github.com/onosproject/onos-config/blob/master/pkg/southbound/synchronizer/synchronizer.go">synchronizer</a>
as we add a device simulator to the onit cluster:</li>
</ul>
<p><img alt="goland_log_and_evaluation" src="../images/goland_log_and_evaluate.gif" /></p>
<h2 id="debugging-example-2-use-simple-delve-client">Debugging. Example #2: Use Simple Delve Client:</h2>
<ul>
<li>
<p>In this example, we assume you already started an onit cluster. If you haven't done that yet, refer to <a href="testing.md">testing</a> for more details. </p>
</li>
<li>
<p>First, you need to install <a href="https://github.com/go-delve/delve/tree/master/Documentation/installation">Delve</a> on your machine to interact 
with the debugger in the onos-config pod. To make sure the debugger is installed successfully on your machine, run <code>dlv</code> command which should show its help. </p>
</li>
<li>
<p>To start debugging and  open a debugger port to the given resource, you can run <code>onit debug</code> command. For example, to forwards a port to the debug port on the onos-config pod, run the following command:</p>
</li>
</ul>
<pre class="highlight"><code class="language-bash">   &gt;onit debug &lt;name of onos-config pod&gt;
     Forwarding from 127.0.0.1:40000 -&gt; 40000
     Forwarding from [::1]:40000 -&gt; 40000</code></pre>

<ul>
<li>To connect to the debugger server which is running in the onos-config pod, run the following command from another terminal:</li>
</ul>
<pre class="highlight"><code class="language-bash">  &gt; dlv connect localhost:40000
    Type 'help' for list of commands.
    (dlv)</code></pre>

<ul>
<li>If the dlv client connects to the server without any problems, you should be able to see the following message in the logs:</li>
</ul>
<pre class="highlight"><code class="language-bash">     &gt; onit get logs onos-config-5d56898bdd-zrmt2
     ....
     2019-07-18T20:55:06Z debug layer=debugger halting</code></pre>

<ul>
<li>To get list of sources that can be used for debugging, run the following command from the dlv CLI:</li>
</ul>
<pre class="highlight"><code class="language-bash">    (dlv) sources
    /go/src/github.com/onosproject/onos-config/cmd/onos-config/onos-config.go
    /go/src/github.com/onosproject/onos-config/modelplugin/Devicesim-1.0.0/devicesim_1_0_0/generated.go
    /go/src/github.com/onosproject/onos-config/modelplugin/Devicesim-1.0.0/modelmain.go
    /go/src/github.com/onosproject/onos-config/modelplugin/TestDevice-1.0.0/modelmain.go
    /go/src/github.com/onosproject/onos-config/modelplugin/TestDevice-1.0.0/testdevice_1_0_0/generated.go
    /go/src/github.com/onosproject/onos-config/modelplugin/TestDevice-2.0.0/modelmain.go
    /go/src/github.com/onosproject/onos-config/modelplugin/TestDevice-2.0.0/testdevice_2_0_0/generated.go
    /go/src/github.com/onosproject/onos-config/pkg/dispatcher/dispatcher.go
    /go/src/github.com/onosproject/onos-config/pkg/events/configevent.go
    /go/src/github.com/onosproject/onos-config/pkg/events/events.go
    /go/src/github.com/onosproject/onos-config/pkg/events/operationalevent.go
    /go/src/github.com/onosproject/onos-config/pkg/events/responseevent.go
    /go/src/github.com/onosproject/onos-config/pkg/events/topoevent.go
    /go/src/github.com/onosproject/onos-config/pkg/manager/getconfig.go
    /go/src/github.com/onosproject/onos-config/pkg/manager/manager.go
    /go/src/github.com/onosproject/onos-config/pkg/manager/rollbackconfig.go
    /go/src/github.com/onosproject/onos-config/pkg/manager/setconfig.go
    /go/src/github.com/onosproject/onos-config/pkg/modelregistry/modelregistry.go
    /go/src/github.com/onosproject/onos-config/pkg/northbound/admin/admin.go
    ....</code></pre>

<ul>
<li>
<p>Suppose you want to set a breakpoint at line 83 of <a href="https://github.com/onosproject/onos-config/blob/master/pkg/southbound/synchronizer/synchronizer.go">synchronizer</a>. To do that, run the following command from dlv CLI: 
<pre class="highlight"><code class="language-bash">    (dlv) break onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:83</code></pre></p>
</li>
<li>
<p>if you set it properly, you should be able to see a message like the following in the logs:
<pre class="highlight"><code class="language-bash">    onit get logs onos-config-5d56898bdd-zrmt2
    ...
    2019-07-18T21:03:24Z info layer=debugger created breakpoint: &amp;api.Breakpoint{ID:2, Name:"", Addr:0xcd62a2, File:"/go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go", Line:83, FunctionName:"github.com/onosproject/onos-config/pkg/southbound/synchronizer.New", Cond:"", Tracepoint:false, TraceReturn:false, Goroutine:false, Stacktrace:0, Variables:[]string(nil), LoadArgs:(*api.LoadConfig)(nil), LoadLocals:(*api.LoadConfig)(nil), HitCount:map[string]uint64{}, TotalHitCount:0x0}</code></pre></p>
</li>
<li>
<p>Run <code>continue</code> from dlv CLI that runs until breakpoint as follows:
 <code>bash
    (dlv) continue</code></p>
</li>
<li>
<p>Then, add a device simulator using <code>onit add simulator</code> command. When onit cluster is trying to add a device simulator to the cluster, the debugger stops at the breakpoint and you should be able to see an output like the following from the dlv CLI:
<pre class="highlight"><code class="language-bash">    (dlv) continue
    &gt; github.com/onosproject/onos-config/pkg/southbound/synchronizer.New() /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:83 (hits goroutine(9):1 total:1) (PC: 0xcd62a2)</code></pre></p>
</li>
<li>
<p>In addition, you can check the onos-config logs to make sure the program stops where you expect to stop:
 <code>bash
    &gt; onit get logs onos-config-5d56898bdd-zrmt2
    2019-07-18T21:16:32Z debug layer=debugger continuing
    I0718 21:18:09.661372      32 dispatcher.go:103] Registering Device sim1 on channel 0xc000083920 and 0xc000083980
    I0718 21:18:09.662158      32 synchronizer.go:64] Connecting to sim1:10161 over gNMI
    I0718 21:18:09.662369      32 clientManager.go:53] Loading default CA onfca
    I0718 21:18:09.662607      32 clientManager.go:60] Loading default certificates
    I0718 21:18:09.702593      32 synchronizer.go:72] sim1:10161 connected over gNMI</code></p>
</li>
<li>Suppose we set another breakpoint at line 89 of <a href="https://github.com/onosproject/onos-config/blob/master/pkg/southbound/synchronizer/synchronizer.go">synchronizer</a> and run <code>continue</code> command from dlv CLI again. The output of dlv CLI and onos-config logs will be like the followings:</li>
</ul>
<pre class="highlight"><code class="language-bash">    (dlv) continue
    &gt; github.com/onosproject/onos-config/pkg/southbound/synchronizer.New() /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:89 (hits goroutine(9):1 total:1) (PC: 0xcd64f9)</code></pre>

<pre class="highlight"><code class="language-bash">    &gt; onit get logs onos-config-5d56898bdd-zrmt2
    ...
    2019-07-18T21:25:21Z info layer=debugger created breakpoint: &amp;api.Breakpoint{ID:3, Name:"", Addr:0xcd64f9, File:"/go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go", Line:89, FunctionName:"github.com/onosproject/onos-config/pkg/southbound/synchronizer.New", Cond:"", Tracepoint:false, TraceReturn:false, Goroutine:false, Stacktrace:0, Variables:[]string(nil), LoadArgs:(*api.LoadConfig)(nil), LoadLocals:(*api.LoadConfig)(nil), HitCount:map[string]uint64{}, TotalHitCount:0x0}
    2019-07-18T21:26:51Z debug layer=debugger continuing
    I0718 21:26:51.518797      32 synchronizer.go:83] sim1:10161 capabilities supported_models:&lt;name:"openconfig-interfaces" organization:"OpenConfig working group" version:"2017-07-14" &gt; supported_models:&lt;name:"openconfig-openflow" organization:"OpenConfig working group" version:"2017-06-01" &gt; supported_models:&lt;name:"openconfig-platform" organization:"OpenConfig working group" version:"2016-12-22" &gt; supported_models:&lt;name:"openconfig-system" organization:"OpenConfig working group" version:"2017-07-06" &gt; supported_encodings:JSON supported_encodings:JSON_IETF gNMI_version:"0.7.0"
    I0718 21:26:51.519659      32 synchronizer.go:305] Getting saved config for sim1</code></pre>

<ul>
<li>
<p>if you run <code>continue</code> again, it passes the breakpoint at line 89 and onos-config will keep running:
<pre class="highlight"><code class="language-bash">    &gt; onit get logs onos-config-5d56898bdd-zrmt2
    ...
    2019-07-18T21:45:01Z debug layer=debugger continuing
    I0718 21:45:01.034584      32 synchronizer.go:89] sim1:10161 has no initial configuration
    I0718 21:45:01.053357      32 synchronizer.go:243] subscribe:&lt;prefix:&lt;&gt; subscription:&lt;path:&lt;&gt; sample_interval:15 heartbeat_interval:15 &gt; subscription:&lt;path:&lt;&gt; sample_interval:15 heartbeat_interval:15 &gt; &gt;</code></pre></p>
</li>
<li>
<p>At this point, you have two breakpoints in the <a href="https://github.com/onosproject/onos-config/blob/master/pkg/southbound/synchronizer/synchronizer.go">synchronizer</a>. To see list of your breakpoints, you can run <code>breakpoints</code> command from dlv CLI.</p>
</li>
</ul>
<p><pre class="highlight"><code class="language-bash">    (dlv) breakpoints
    Breakpoint runtime-fatal-throw at 0x6ab830 for runtime.fatalthrow() /usr/local/go/src/runtime/panic.go:663 (0)
    Breakpoint unrecovered-panic at 0x6ab8a0 for runtime.fatalpanic() /usr/local/go/src/runtime/panic.go:690 (0)
        print runtime.curg._panic.arg
    Breakpoint 4 at 0xcd62a2 for github.com/onosproject/onos-config/pkg/southbound/synchronizer.New() /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:83 (1)
    Breakpoint 5 at 0xcd64f9 for github.com/onosproject/onos-config/pkg/southbound/synchronizer.New() /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:89 (0)</code></pre>
You can repeat the above steps by adding another simulator to onos-config and monitor dlv CLI and onos-config pod logs.</p>
<h3 id="print-local-variables">Print Local Variables</h3>
<ul>
<li>When you set breakpoints in a file, you can also print local variables as you go through the breakpoints. For example, look at the following piece of code from <a href="https://github.com/onosproject/onos-config/blob/master/pkg/southbound/synchronizer/synchronizer.go">synchronizer</a>:</li>
</ul>
<pre class="highlight"><code class="language-bash">    target := southbound.Target{}
    key, err := target.ConnectTarget(context, *sync.Device)
    sync.key = key</code></pre>

<ul>
<li>Suppose we add a simulator and we would like to print the value of key when it passes this block of code. You can use <code>print</code> function from dlv CLI to print local variables in the code:</li>
</ul>
<pre class="highlight"><code class="language-bash">    (dlv) print key
    github.com/onosproject/onos-config/pkg/southbound.DeviceID {
        DeviceID: "sim2:10161",}</code></pre>

<div class="codehilite"><pre><span></span><span class="k">or</span> <span class="k">to</span> <span class="n">print</span> <span class="ss">`capResponse`</span> <span class="n">variable</span><span class="p">:</span>
</pre></div>


<p><code>bash
    (dlv) print capResponse
    *github.com/openconfig/gnmi/proto/gnmi.CapabilityResponse {
        SupportedModels: []*github.com/openconfig/gnmi/proto/gnmi.ModelData len: 4, cap: 4, [
            *(*"github.com/openconfig/gnmi/proto/gnmi.ModelData")(0xc00042e280),
            *(*"github.com/openconfig/gnmi/proto/gnmi.ModelData")(0xc00042e2d0),
            *(*"github.com/openconfig/gnmi/proto/gnmi.ModelData")(0xc00042e320),
            *(*"github.com/openconfig/gnmi/proto/gnmi.ModelData")(0xc00042e370),
        ],
        SupportedEncodings: []github.com/openconfig/gnmi/proto/gnmi.Encoding len: 2, cap: 2, [Encoding_JSON (0),Encoding_JSON_IETF (4)],
        GNMIVersion: "0.7.0",
        Extension: []*github.com/openconfig/gnmi/proto/gnmi_ext.Extension len: 0, cap: 0, nil,
        XXX_NoUnkeyedLiteral: struct {} {},
        XXX_unrecognized: []uint8 len: 0, cap: 0, nil,
        XXX_sizecache: 0,}</code></p>
<ul>
<li>You can also check the list of local variables using <code>locals</code> command from dlv CLI, for example:</li>
</ul>
<pre class="highlight"><code class="language-bash">    (dlv) locals
    sync = ("*github.com/onosproject/onos-config/pkg/southbound/synchronizer.Synchronizer")(0xc000368000)
    capResponse = ("*github.com/openconfig/gnmi/proto/gnmi.CapabilityResponse")(0xc000346d80)
    target = github.com/onosproject/onos-config/pkg/southbound.Target {Destination: (*"github.com/openconfig/gnmi/client.Destination")(0xc0004e00e0), Clt: github.com/onosproject/onos-config/pkg/southbound.GnmiClient(github.com/onosproject/onos-config/pkg/southbound.gnmiClientImpl) *(*"github.com/onosproject/onos-config/pkg/southbound.GnmiClient")(0xc0004e0130), Ctx: context.Context(*context.emptyCtx) ...}
    key = github.com/onosproject/onos-config/pkg/southbound.DeviceID {DeviceID: "sim1:10161"}
    err = error nil
    capErr = error nil</code></pre>

<h3 id="goroutines">Goroutines</h3>
<ul>
<li>
<p>To check which goroutine is running when you are going through a piece of code using breakpoints, you can run the following command from dlv CLI:
<pre class="highlight"><code class="language-bash">    (dlv) goroutine
    Goroutine 12:
        Runtime: /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:83 github.com/onosproject/onos-config/pkg/southbound/synchronizer.New (0xcd62a2)
        User: /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:83 github.com/onosproject/onos-config/pkg/southbound/synchronizer.New (0xcd62a2)
        Go: /go/src/github.com/onosproject/onos-config/pkg/manager/manager.go:217 github.com/onosproject/onos-config/pkg/manager.(*Manager).Run (0xcdfb0c)
        Start: /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/factory.go:30 github.com/onosproject/onos-config/pkg/southbound/synchronizer.Factory (0xcd4aa0)</code></pre></p>
</li>
<li>
<p>To check list of all goroutines which potentially can be running in onos-config, you can run the following command from dlv CLI:
<pre class="highlight"><code class="language-bash">    (dlv) goroutines
      Goroutine 1 - User: /usr/local/go/src/runtime/netpoll.go:182 internal/poll.runtime_pollWait (0x6a7b5e)
      Goroutine 2 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 3 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 4 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 5 - User: /go/src/github.com/onosproject/onos-config/vendor/k8s.io/klog/klog.go:990 k8s.io/klog.(*loggingT).flushDaemon (0x8227a3)
      Goroutine 6 - User: /go/src/github.com/onosproject/onos-config/vendor/github.com/golang/glog/glog.go:882 github.com/golang/glog.(*loggingT).flushDaemon (0xca8b23)
      Goroutine 7 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 8 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 9 - User: /go/src/github.com/onosproject/onos-config/pkg/dispatcher/dispatcher.go:58 github.com/onosproject/onos-config/pkg/dispatcher.(*Dispatcher).Listen (0x82a193)
      Goroutine 10 - User: /go/src/github.com/onosproject/onos-config/pkg/dispatcher/dispatcher.go:86 github.com/onosproject/onos-config/pkg/dispatcher.(*Dispatcher).ListenOperationalState (0x82a96b)
      Goroutine 11 - User: /go/src/github.com/onosproject/onos-config/pkg/manager/manager.go:236 github.com/onosproject/onos-config/pkg/manager.listenOnResponseChannel (0xcdfd20)
    * Goroutine 12 - User: /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:83 github.com/onosproject/onos-config/pkg/southbound/synchronizer.New (0xcd62a2) (thread 60)
      Goroutine 18 - User: /usr/local/go/src/runtime/lock_futex.go:228 runtime.notetsleepg (0x685a74)
      Goroutine 19 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 20 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 34 - User: /usr/local/go/src/runtime/lock_futex.go:228 runtime.notetsleepg (0x685a74)
      Goroutine 35 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 83 - User: /usr/local/go/src/runtime/proc.go:302 runtime.gopark (0x6ae2c4)
      Goroutine 101 - User: /usr/local/go/src/runtime/netpoll.go:182 internal/poll.runtime_pollWait (0x6a7b5e)
      Goroutine 102 - User: /go/src/github.com/onosproject/onos-config/vendor/google.golang.org/grpc/internal/transport/controlbuf.go:317 google.golang.org/grpc/internal/transport.(*controlBuffer).get (0xb54ae3)
      Goroutine 103 - User: /go/src/github.com/onosproject/onos-config/vendor/google.golang.org/grpc/stream.go:320 google.golang.org/grpc.newClientStream.func5 (0xc3492d)
      Goroutine 104 - User: /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:130 github.com/onosproject/onos-config/pkg/southbound/synchronizer.(*Synchronizer).syncConfigEventsToDevice (0xcd72a5)
      Goroutine 105 - User: /go/src/github.com/onosproject/onos-config/vendor/google.golang.org/grpc/internal/transport/transport.go:267 google.golang.org/grpc/internal/transport.(*Stream).waitOnHeader (0xb7e542)
    .....
    [49 goroutines]</code></pre></p>
</li>
</ul>
<h3 id="debug-your-code-line-by-line">Debug Your Code Line by Line</h3>
<ul>
<li>After setting a breakpoint in a source file, you can execute your code line by line  using <code>next</code> or <code>n</code> command from dlv CLI: For example:
<pre class="highlight"><code>    (dlv) n
    &gt; github.com/onosproject/onos-config/pkg/southbound/synchronizer.New() /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:88 (PC: 0xcd64e9)
    (dlv) n
    &gt; github.com/onosproject/onos-config/pkg/southbound/synchronizer.New() /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:89 (PC: 0xcd64f9)
    (dlv) n
    &gt; github.com/onosproject/onos-config/pkg/southbound/synchronizer.New() /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:123 (PC: 0xcd65ec)
    (dlv) n</code></pre></li>
</ul>
<h3 id="print-stack-trace">Print Stack Trace</h3>
<ul>
<li>To print stack trace, you can run <code>stack</code> command as  follows:</li>
</ul>
<pre class="highlight"><code class="language-bash">    (dlv) stack
    0  0x0000000000cd62a2 in github.com/onosproject/onos-config/pkg/southbound/synchronizer.New
       at /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/synchronizer.go:83
    1  0x0000000000cd518e in github.com/onosproject/onos-config/pkg/southbound/synchronizer.Factory
       at /go/src/github.com/onosproject/onos-config/pkg/southbound/synchronizer/factory.go:49
    2  0x00000000006dae71 in runtime.goexit
       at /usr/local/go/src/runtime/asm_amd64.s:1337</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      



<!-- Application footer -->
<footer class="md-footer">

    <!-- Further information -->
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">

            <!-- Copyright and theme information -->
            <div class="md-footer-copyright">
                
                powered by
                <a href="https://www.mkdocs.org" title="MkDocs">MkDocs</a>
                and
                <a href="https://squidfunk.github.io/mkdocs-material/"
                   title="Material for MkDocs">
                    Material for MkDocs</a>
            </div>

            <!-- Social links -->
            
            
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/onosproject" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://onosproject.slack.com/" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://www.youtube.com/channel/UCTQaOpqno48GTimdwyfytFw" class="md-footer-social__link fa fa-youtube"></a>
    
  </div>

            
        </div>
    </div>
</footer>


    </div>
    
      <script src="../../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>